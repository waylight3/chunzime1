{% load staticfiles %}
<!DOCTYPE html>
<html>

<head>
    <title>Chunzime</title>
    <link rel="stylesheet" type="text/css" href="{% static "css/home.css" %}"/>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
</head>

<body>
	<div class = "container">
		<nav class = "navbar">
            <img src="{% static "img/logo.png" %}"/>
            <img src="{% static "img/title.png" %}"/>
        </nav>
		<div class = "description">
			<span class="red">천지</span><span class="blue">미</span><span class="small">CHUNZIME</span>는 IBM에서 제공하는 WATSON API를 통하여 재해에 대한 기초 상식, 대처법, 발생 규모와 시기 등을 알려주어 안전한 대한민국을 만들고자 합니다.<br/><br/><br/>아래에 있는 검색을 통해 얻고 싶은 정보를 입력해보세요!<br/>(EX. Tell me how to deal with earthquake)
		</div>
		<div class = "wrapper">
            <div class = "box">
                <div class="chatroom" id="chatroom">

                </div>
            </div>
		</div>
		<div class = "search">
            <div class = "insearch">
                <input type="text" name="question" id="question" onkeydown = "onKeyDown();"/>
                <img id="send_btn" src="{% static "img/send.png" %}" onclick = "tongsin();" />
            </div>
		</div>
        <footer></footer>
	</div>
	<script type="text/javascript">
		function onKeyDown(){
		    if(event.keyCode == 13){
		    	tongsin();
		    }
		}

		$("#send_btn").hover(function() {
   			$(this).attr("src", "{% static "img/sendover.png" %}");
		}, function(){
    		$(this).attr("src", "{% static "img/send.png" %}");
		});

		function tongsin(){
			var str = $("#question").val();

			if($.trim(str).length == 0) return;
		    $("#question").val("");
			userinput(str);
			$.ajax({
				type: "get",
				url: "/conversation",
				dataType: "json",
				data: { message: str },
				success: function(result) {
					var str2 = "";
					str2 += result["answer"];
					watsoninput(str2);
				}
			});
		}
		//user's input = question
		function userinput(str){
			var parent = document.getElementById("chatroom");
			var div = document.createElement("div");
			div.className = "user";
			var image = document.createElement("img");
			image.src = "{% static "img/ilban_in.png" %}";
			var div2 = document.createElement("div");
			div2.className = "chat";
			var t = document.createTextNode(str);
			div2.appendChild(t);
			div.appendChild(image);
			div.appendChild(div2);
			parent.appendChild(div);
			parent.scrollTop = parent.scrollHeight;
		}

		function watsoninput(str){
			var parent = document.getElementById("chatroom");
			var div = document.createElement("div");
			div.className = "watson";
			var image = document.createElement("img");
			image.src = "{% static "img/baksa_nim.png" %}";
			var div2 = document.createElement("div");
			div2.className = "chat";
			var t = document.createTextNode(str);
			div2.appendChild(t);
			div.appendChild(image);
			div.appendChild(div2);
			parent.appendChild(div);
			parent.scrollTop = parent.scrollHeight;
		}
	</script>
</body>

</html>
